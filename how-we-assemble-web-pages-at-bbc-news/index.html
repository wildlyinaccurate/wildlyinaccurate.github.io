<!doctype html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width,initial-scale=1"> <title>How we assemble web pages at BBC News | Wildly Inaccurate</title> <meta name="description" content="   This post is about the Web Application Framework in use by some teams at the BBC. It is not strictly a framework in that it specifies the contracts between components, rather than providing concrete implementations of the components. For this r..."> <meta name="theme-color" content="#8e44ad"> <meta property="og:image" content="https://wildlyinaccurate.com/assets/dfi.jpg"> <meta name="twitter:card" content="summary"> <style>img,svg{vertical-align:middle}ol,p,pre,table,ul{margin-bottom:1rem}a,table{background-color:transparent}ol,p,pre,ul{margin-top:0}#carbonads,article,footer,header,nav,section{display:block}a:active,a:hover{outline-width:0}svg:not(:root){overflow:hidden}*,::after,::before{box-sizing:border-box}html{font-family:sans-serif;line-height:1.15;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;-ms-overflow-style:scrollbar;-webkit-tap-highlight-color:transparent}@-ms-viewport{width:device-width}body{margin:0;font-family:serif;font-size:1.12rem;font-weight:400;line-height:1.5;color:#212529;text-align:left;background-color:#fff}ul ul{margin-bottom:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:80%}a{color:#7700a8;text-decoration:none;-webkit-text-decoration-skip:objects}a:hover{color:#41005c;text-decoration:underline}code,pre{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}pre{overflow:auto;-ms-overflow-style:scrollbar;padding:1rem}img{border-style:none;max-width:100%;height:auto}svg{overflow:hidden}table{border-collapse:collapse;width:100%}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}.btn,h1,h2,h3,h4,h5{font-family:sans-serif}h1,h2,h3,h4,h5{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2;color:inherit}h1{font-size:2.8rem}h2{font-size:2.24rem}h3{font-size:1.848rem}h4{font-size:1.68rem}h5{font-size:1.4rem}small{font-weight:400}table td{padding:.75rem;vertical-align:top}table,table td{border:1px solid #dee2e6}#carbonads{margin:1rem auto;max-width:200px}.mb-4,.my-4{margin-bottom:1.5rem}.carbon-poweredby,.carbon-text{color:#6c757d;display:block;margin-top:.5rem}.btn,.d-ib{display:inline-block}blockquote{border-left:5px solid #7700a8;padding:1rem 2rem 1px}.btn{background:#7700a8;color:#fff}.btn:focus,.btn:hover{background:rgba(119,0,168,.8);color:#fff}.btn--inverse{background:rgba(255,255,255,.67);color:#7700a8}.btn--inverse:focus,.btn--inverse:hover{background:rgba(255,255,255,.4)}code,pre{background:#f8f9fa;font-size:87.5%}code{padding:.3333333333rem .5rem;white-space:pre-wrap}pre code{padding:0}[class*=language-] pre,[class*=language-] pre code{background:#212529}footer{border-top:1px solid #6c757d}.post-content>*,.wrap{width:100%;padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto;max-width:960px;max-width:1140px}@media (min-width:576px){.post-content>*,.wrap{max-width:540px}}@media (min-width:768px){.post-content>*,.wrap{max-width:720px}}.post-content>ol,.post-content>ul{padding-left:45px}.outset{width:1280px;max-width:90%}@media (max-width:767.98px){.outset{max-width:100%}}.ls-n{list-style:none}h2{margin-top:1.5rem}h3{margin-top:1rem}.page-header{color:#fff;min-height:240px;overflow:hidden;position:relative;text-shadow:-1px 0 1px #000}.page-header a{color:#fff}.va-m{vertical-align:middle}.c-gl{color:#6c757d}.z-1{z-index:1}.z--1{z-index:-1}.f-r{float:right}.pos-a{position:absolute}.b-0{bottom:0}.h-100{height:100%}.h-4{height:1.5rem}.w-100{width:100%}.w-4{width:1.5rem}@media (min-width:768px){.h-md-a{height:auto}}.mw-w{max-width:880px}.mw-n{max-width:none}.my-4{margin-top:1.5rem}.mt-5{margin-top:3rem}.p-2{padding:.5rem}.pt-2{padding-top:.5rem}.p-3{padding:1rem}.pb-3{padding-bottom:1rem}.pt-4{padding-top:1.5rem}.pt-5{padding-top:3rem}@media (min-width:576px){.p-sm-3{padding:1rem}}.ta-c{text-align:center}</style> <link rel="manifest" href="/manifest.json"> <link rel="canonical" href="https://wildlyinaccurate.com/how-we-assemble-web-pages-at-bbc-news"> <link rel="alternate" type="application/atom+xml" title="Wildly Inaccurate" href="https://wildlyinaccurate.com/feed.xml"> <style>.hll{background-color:#49483e}.c{color:#75715e}.err{color:#960050;background-color:#1e0010}.k{color:#66d9ef}.l{color:#ae81ff}.n{color:#f8f8f2}.o{color:#f92672}.p{color:#f8f8f2}.c1,.cm,.cp,.cs{color:#75715e}.ge{font-style:italic}.gs{font-weight:700}.kc,.kd{color:#66d9ef}.kn{color:#f92672}.kp,.kr,.kt{color:#66d9ef}.ld{color:#e6db74}.m{color:#ae81ff}.s{color:#e6db74}.na{color:#a6e22e}.nb{color:#f8f8f2}.nc{color:#a6e22e}.no{color:#66d9ef}.nd{color:#a6e22e}.ni{color:#f8f8f2}.ne,.nf{color:#a6e22e}.nl,.nn{color:#f8f8f2}.nx{color:#a6e22e}.py{color:#f8f8f2}.nt{color:#f92672}.nv{color:#f8f8f2}.ow{color:#f92672}.w{color:#f8f8f2}.mf,.mh,.mi,.mo{color:#ae81ff}.s2,.sb,.sc,.sd{color:#e6db74}.se{color:#ae81ff}.s1,.sh,.si,.sr,.ss,.sx{color:#e6db74}.bp,.vc,.vg,.vi{color:#f8f8f2}.il{color:#ae81ff}.gu{color:#75715e}.gd{color:#f92672}.gi{color:#a6e22e}</style> </head> <body> <nav class="pos-a w-100 z-1"> <div class="wrap mw-w"> <a class="btn p-2 p-sm-3" href="https://wildlyinaccurate.com">Wildly Inaccurate</a> <div class="f-r"> <a class="btn btn--inverse p-2 p-sm-3" href="/about/">About</a> <a class="btn btn--inverse p-2 p-sm-3" href="/projects/">Projects</a> <a class="btn btn--inverse p-2 p-sm-3" href="/search/">Search</a> </div> </div> </nav> <header class="page-header mb-4"> <img class="pos-a b-0 h-100 mw-n h-md-a z--1" src="/assets/dfi.jpg" srcset="/assets/r/330/dfi.jpg 330w, /assets/r/345/dfi.jpg 345w, /assets/r/381/dfi.jpg 381w, /assets/r/384/dfi.jpg 384w, /assets/r/546/dfi.jpg 546w, /assets/r/640/dfi.jpg 640w, /assets/r/738/dfi.jpg 738w, /assets/r/840/dfi.jpg 840w, /assets/r/960/dfi.jpg 960w, /assets/r/1250/dfi.jpg 1250w, /assets/r/1366/dfi.jpg 1366w, /assets/r/1440/dfi.jpg 1440w, /assets/r/1680/dfi.jpg 1680w, /assets/dfi.jpg 2600w"> <div class="wrap mw-w mt-5 pt-2"> <h1 class="mt-5">How we assemble web pages at BBC News</h1> <p class="pt-2 pt-lg-4"> Feb 13, 2017 &#x2022; 5 minute read &#x2022; posted in [ <a href="/category/BBC News/">BBC News</a> ] </p> </div> </header> <article class="post-content"> <blockquote> <p>This post is about the Web Application Framework in use by some teams at the BBC. It is not strictly a framework in that it specifies the contracts between components, rather than providing concrete implementations of the components. For this reason, I prefer to think of it as the Web Application <em>Specification</em>.</p> </blockquote> <p>At the beginning of 2015, a group of developers and technical architects from around the BBC got together with the goal of designing a system for sharing web page components between teams. This came from an acceptance that most of the BBC&#x2019;s public-facing web products have a similar look &amp; feel, and a desire to improve efficiency through sharing rather than building similar things over and over again.<!--more--></p> <div class="my-4 ta-c outset"> <img alt="Cards or &apos;promos&apos; from BBC Programmes, BBC Sport, BBC News, and CBBC." src="/assets/bbc-promo-similarities.png" width="961" srcset="/assets/r/330/bbc-promo-similarities.png 330w, /assets/r/345/bbc-promo-similarities.png 345w, /assets/r/381/bbc-promo-similarities.png 381w, /assets/r/384/bbc-promo-similarities.png 384w, /assets/r/546/bbc-promo-similarities.png 546w, /assets/r/640/bbc-promo-similarities.png 640w, /assets/r/738/bbc-promo-similarities.png 738w, /assets/r/840/bbc-promo-similarities.png 840w, /assets/r/960/bbc-promo-similarities.png 960w, /assets/bbc-promo-similarities.png 961w"> <div class="c-gl caption"> <small><i>Cards or &apos;promos&apos; from BBC Programmes, BBC Sport, BBC News, and CBBC.</i></small> </div> </div> <p>In some organisations, technologies are standardised which makes sharing components between teams a trivial task. At the BBC, teams are free to use whichever technologies they like. This means that any component-sharing solution we come up with can&#x2019;t be tied to a template language, data structure, build system, or even a CSS preprocessor. This meant that building a component library like <a href="http://rizzo.lonelyplanet.com/styleguide/ui-components">Lonely Planet&#x2019;s Rizzo</a> or <a href="https://cloudflare.github.io/cf-ui/">CloudFlare&#x2019;s CFUI</a> was out of the picture. We also felt that something like <a href="http://registry.origami.ft.com/components">the FT&#x2019;s Origami</a> would require too much effort on the users of the components.</p> <p>We ended up going back to basics and designed a solution that is based on two premises:</p> <ol> <li>All of our web pages are built out of HTML, CSS, and JavaScript.</li> <li>Most pages have three main parts: the head, which contains metadata and styling; the body, which contains content; and the part at the end of the body, which contains JavaScript.</li> </ol> <p>What we came up with is called the WAF, or <em>Web Application Framework</em>. It&#x2019;s a surprisingly simple framework, and is built on top of three core principles:</p> <ul> <li>Components as endpoints</li> <li>The envelope contract</li> <li>Page composition</li> </ul> <h2 id="components-as-endpoints">Components as endpoints</h2> <p>For components to be shared successfully, they need to be easy to distribute, easy to install, and easy to use. For this, we turned to a delivery mechanism that most developers are familiar with: the web.</p> <p>Every component is available at an HTTP endpoint. How that endpoint is built is unimportant, and varies from team to team. Some teams deploy dedicated applications that render specific components. Others make use of an internal component-as-an-endpoint service. Regardless of the implementation, to integrate successfully into the WAF, every component endpoint must to respond to an HTTP GET request with a rendered component that is ready to be inserted into a page.</p> <h2 id="the-envelope-contract">The envelope contract</h2> <p>Having components as endpoints only works if all of the components are returned in the same format. To solve this, we designed the envelope format which imposes a contract on both the component endpoints and the consumers of those endpoints. The contract for component endpoints is this:</p> <ul> <li>Component endpoints MAY accept parameters which vary the output.</li> <li>Component endpoints MUST return a JSON object with the following properties: <ul> <li><code class="highlighter-rouge">head</code> &#x2014; an array of strings intended to be inserted into the document <code class="highlighter-rouge">&lt;head&gt;</code> element. Usually stylesheets, metadata, and blocking scripts.</li> <li><code class="highlighter-rouge">bodyInline</code> &#x2014; a string intended to be inserted somewhere in the document <code class="highlighter-rouge">&lt;body&gt;</code>.</li> <li><code class="highlighter-rouge">bodyLast</code> &#x2014; an array of strings intended to be inserted at the end of the document <code class="highlighter-rouge">&lt;body&gt;</code>. Usually non-blocking scripts.</li> </ul> </li> <li>Component endpoints SHOULD atomise the <code class="highlighter-rouge">head</code> and <code class="highlighter-rouge">bodyLast</code> values as much as possible.</li> </ul> <p>Here is an example envelope response:</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="s2">&quot;head&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">&quot;&lt;link rel=</span><span class="se">\&quot;</span><span class="s2">stylesheet</span><span class="se">\&quot;</span><span class="s2"> href=</span><span class="se">\&quot;</span><span class="s2">https://m.files.bbci.co.uk/framework.css</span><span class="se">\&quot;</span><span class="s2">&gt;&quot;</span><span class="w">
        </span><span class="s2">&quot;&lt;style&gt;.nw-c-top-stories{padding-bottom:2rem}&lt;/style&gt;&quot;</span><span class="p">,</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="s2">&quot;bodyInline&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;div class=</span><span class="se">\&quot;</span><span class="s2">nw-c-top-stories</span><span class="se">\&quot;</span><span class="s2">&gt;[... lots of markup ...]&lt;/div&gt;&quot;</span><span class="p">,</span><span class="w">
    </span><span class="s2">&quot;bodyLast&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">&quot;&lt;script async defer src=</span><span class="se">\&quot;</span><span class="s2">https://m.files.bbci.co.uk/modules/bbc-news-front-page/2.0.8/init.js</span><span class="se">\&quot;</span><span class="s2">&gt;&lt;/script&gt;&quot;</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <h2 id="page-composition">Page composition</h2> <p>Now that we have web page components available in a standardised format over HTTP, we need a way to assemble the components into a page. To this end, there is a contract for systems that receive envelopes, which we call <em>page composition</em> systems:</p> <ul> <li>Page composition systems MUST render components in the order they are specified.</li> <li>Page composition systems MUST de-duplicate all <code class="highlighter-rouge">head</code> and <code class="highlighter-rouge">bodyLast</code> values.</li> <li>Page composition systems SHOULD fetch components in parallel.</li> </ul> <p>The de-duplicating aspect of a page composition system is important, because page components may share many of the same dependencies. For example, if many components were built using the Bootstrap CSS framework, they would all return a reference to <code class="highlighter-rouge">bootstrap.css</code> in their <code class="highlighter-rouge">head</code>. Rather than render several redundant references to this CSS, the page composition system must ensure that it is rendered only once.</p> <p>Many BBC teams have implemented their own page composition systems within their existing web applications. BBC News have developed a page composition service called Mozart which provides a simple configuration-driven way to assemble pages while transparently handling the difficult problems like scaling, logging, and monitoring.</p> <h2 id="piecing-it-all-together">Piecing it all together</h2> <p>This method of assembling web pages is being used successfully in production by several teams at the BBC. The most-used component is a live-updating news feed, initially built for live coverage of sports events on BBC Sport, but now used for live reporting pages on <a href="http://www.bbc.co.uk/news/live/uk-england-manchester-38860956">BBC News</a>, and the <a href="http://www.bbc.com/persian/live/institutional-38891510">World Service</a>. It has also seen some use as a way to display long feeds of content like on the <a href="http://www.bbc.co.uk/news/topics/8abd564a-2b8e-401c-9916-34982cb67b55/womens-rights">BBC News topic pages</a>. Soon BBC News will roll out their new front page using the WAF, which is a good opportunity for us to stress-test the framework and expand it if necessary.</p> <p>One of the expansions we&#x2019;re currently looking at is a mechanism for components to declare their cacheability. This will help to reduce the load on component endpoints and on page composition systems as well.</p> </article> <div class="wrap pt-4"> <p> <i>Have any questions or comments? Feel free to reach out on Twitter: <a href="https://twitter.com/Joseph_Wynn">@Joseph_Wynn</a></i> </p> <small> <blockquote> <p>This post was published on <b>13 February, 2017</b> and last updated on <b>15 June, 2018</b>. It was posted in [<a href="/category/BBC News/">BBC News</a>] and tagged with [<a href="/tag/bbc news/">bbc news</a>] </p> </blockquote> </small> </div> <footer class="wrap mw-w mt-5 pt-4"> <ul class="ls-n f-r"> <li> <a href="https://github.com/wildlyinaccurate"> <span class="d-ib va-m w-4 h-4"> <svg viewbox="0 0 16 16"> <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/> </svg> </span> <span>wildlyinaccurate</span> </a> </li> <li> <a href="https://twitter.com/joseph_wynn"> <span class="d-ib va-m w-4 h-4"> <svg viewbox="0 0 16 16"> <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                        c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/> </svg> </span> <span>joseph_wynn</span> </a> </li> </ul> <small> <i>A collection of guides &amp; opinions about programming and the state of the web. </i> </small> </footer> <script> if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/service-worker.js')
            }

            
            window.LUX = {
                label: 'article'
            } </script> <script src="https://cdn.speedcurve.com/js/lux.js?id=73376842" async defer="defer"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-20744182-3', { siteSpeedSampleRate: 100 });
            ga('send', 'pageview'); </script> <script> (function() {
                var s, p, n, a;

                s = document.createElement('script');
                s.async = 1;
                s.defer = 1;
                s.src = 'https://cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=wildlyinaccuratecom';
                s.id = '_carbonads_js';

                p = document.createElement('small');
                p.className = 'ta-c';
                p.appendChild(s);

                n = document.querySelector('article > p:nth-of-type(3)');

                if (n) {
                    n.parentNode.insertBefore(p, n.nextSibling);
                } else {
                    n = document.getElementsByTagName('article')[0];
                    n.parentNode.insertBefore(p, n.nextSibling);
                }
            })(); </script> </body> </html> 