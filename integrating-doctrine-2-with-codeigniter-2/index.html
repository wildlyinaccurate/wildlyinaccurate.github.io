<!doctype html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width,initial-scale=1"> <meta name="theme-color" content="#8e44ad"> <title>Integrating Doctrine 2 with CodeIgniter 2 | Wildly Inaccurate</title> <meta name="description" content="If you&#x2019;re looking for a quick way to get Doctrine 2 running with CodeIgniter 2, you might want to download my CodeIgniter 2/Doctrine 2 package  Overview  CodeIgniter is a great PHP framework. The codebase is clean, the documentation is fantastic, ..."> <meta property="og:title" content="Integrating Doctrine 2 with CodeIgniter 2"> <meta property="og:description" content="If you&#x2019;re looking for a quick way to get Doctrine 2 running with CodeIgniter 2, you might want to download my CodeIgniter 2/Doctrine 2 package  Overview  CodeIgniter is a great PHP framework. The codebase is clean, the documentation is fantastic, ..."> <meta property="og:image" content="https://wildlyinaccurate.com/assets/dfi.jpg"> <style>img,svg{vertical-align:middle}ol,p,pre,table,ul{margin-bottom:1rem}a,table{background-color:transparent}ol,p,pre,ul{margin-top:0}#carbonads,article,footer,header,nav,section{display:block}a:active,a:hover{outline-width:0}svg:not(:root){overflow:hidden}*,::after,::before{box-sizing:border-box}html{font-family:sans-serif;line-height:1.15;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;-ms-overflow-style:scrollbar;-webkit-tap-highlight-color:transparent}@-ms-viewport{width:device-width}body{margin:0;font-family:serif;font-size:1.12rem;font-weight:400;line-height:1.5;color:#212529;text-align:left;background-color:#fff}ul ul{margin-bottom:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:80%}a{color:#7700a8;text-decoration:none;-webkit-text-decoration-skip:objects}a:hover{color:#41005c;text-decoration:underline}code,pre{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}pre{overflow:auto;-ms-overflow-style:scrollbar;padding:1rem}img{border-style:none;max-width:100%;height:auto}svg{overflow:hidden}table{border-collapse:collapse;width:100%}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}.btn,h1,h2,h3,h4,h5{font-family:sans-serif}h1,h2,h3,h4,h5{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2;color:inherit}h1{font-size:2.8rem}h2{font-size:2.24rem}h3{font-size:1.848rem}h4{font-size:1.68rem}h5{font-size:1.4rem}small{font-weight:400}table td{padding:.75rem;vertical-align:top}table,table td{border:1px solid #dee2e6}#carbonads{margin:1rem auto;max-width:200px}.mb-4,.my-4{margin-bottom:1.5rem}.carbon-poweredby,.carbon-text{color:#6c757d;display:block;margin-top:.5rem}.btn,.d-ib{display:inline-block}blockquote{border-left:5px solid #7700a8;padding:1rem 2rem 1px}.btn{background:#7700a8;color:#fff}.btn:focus,.btn:hover{background:rgba(119,0,168,.8);color:#fff}.btn--inverse{background:rgba(255,255,255,.67);color:#7700a8}.btn--inverse:focus,.btn--inverse:hover{background:rgba(255,255,255,.4)}code,pre{background:#f8f9fa;font-size:87.5%}code{padding:.3333333333rem .5rem;white-space:pre-wrap}pre code{padding:0}[class*=language-] pre,[class*=language-] pre code{background:#212529}footer{border-top:1px solid #6c757d}.post-content>*,.wrap{width:100%;padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto;max-width:960px;max-width:1140px}@media (min-width:576px){.post-content>*,.wrap{max-width:540px}}@media (min-width:768px){.post-content>*,.wrap{max-width:720px}}.post-content>ol,.post-content>ul{padding-left:45px}.outset{width:1280px;max-width:90%}@media (max-width:767.98px){.outset{max-width:100%}}.ls-n{list-style:none}h2{margin-top:1.5rem}h3{margin-top:1rem}.page-header{color:#fff;min-height:240px;overflow:hidden;position:relative;text-shadow:-1px 0 1px #000}.page-header a{color:#fff}.va-m{vertical-align:middle}.c-gl{color:#6c757d}.z-1{z-index:1}.z--1{z-index:-1}.f-r{float:right}.pos-a{position:absolute}.b-0{bottom:0}.h-100{height:100%}.h-4{height:1.5rem}.w-100{width:100%}.w-4{width:1.5rem}@media (min-width:768px){.h-md-a{height:auto}}.mw-w{max-width:880px}.mw-n{max-width:none}.my-4{margin-top:1.5rem}.mt-5{margin-top:3rem}.p-2{padding:.5rem}.pt-2{padding-top:.5rem}.p-3{padding:1rem}.pb-3{padding-bottom:1rem}.pt-4{padding-top:1.5rem}.pt-5{padding-top:3rem}@media (min-width:576px){.p-sm-3{padding:1rem}}.ta-c{text-align:center}</style> <link rel="manifest" href="/manifest.json"> <link rel="canonical" href="https://wildlyinaccurate.com/integrating-doctrine-2-with-codeigniter-2"> <link rel="alternate" type="application/atom+xml" title="Wildly Inaccurate" href="https://wildlyinaccurate.com/feed.xml"> </head> <body> <nav class="pos-a w-100 z-1"> <div class="wrap mw-w"> <a class="btn p-2 p-sm-3" href="https://wildlyinaccurate.com">Wildly Inaccurate</a> <div class="f-r"> <a class="btn btn--inverse p-2 p-sm-3" href="/about/">About</a> <a class="btn btn--inverse p-2 p-sm-3" href="/projects/">Projects</a> <a class="btn btn--inverse p-2 p-sm-3" href="/search/">Search</a> </div> </div> </nav> <header class="page-header mb-4"> <img class="pos-a b-0 h-100 mw-n h-md-a z--1" src="/assets/dfi.jpg" srcset="/assets/r/330/dfi.jpg 330w, /assets/r/345/dfi.jpg 345w, /assets/r/381/dfi.jpg 381w, /assets/r/384/dfi.jpg 384w, /assets/r/546/dfi.jpg 546w, /assets/r/640/dfi.jpg 640w, /assets/r/738/dfi.jpg 738w, /assets/r/840/dfi.jpg 840w, /assets/r/960/dfi.jpg 960w, /assets/r/1250/dfi.jpg 1250w, /assets/r/1366/dfi.jpg 1366w, /assets/r/1440/dfi.jpg 1440w, /assets/r/1680/dfi.jpg 1680w, /assets/dfi.jpg 2600w"> <div class="wrap mw-w mt-5 pt-2"> <h1 class="mt-5">Integrating Doctrine 2 with CodeIgniter 2</h1> <p class="pt-2 pt-lg-4"> Sep 26, 2010 &#x2022; 11 minute read &#x2022; posted in [ <a href="/category/CodeIgniter/">CodeIgniter</a>, <a href="/category/Doctrine/">Doctrine</a>, <a href="/category/PHP/">PHP</a>, <a href="/category/Web Development/">Web Development</a> ] </p> </div> </header> <article class="post-content"> <p><em>If you&#x2019;re looking for a quick way to get Doctrine 2 running with CodeIgniter 2, you might want to download my <a href="https://github.com/wildlyinaccurate/CodeIgniter-2-with-Doctrine-2">CodeIgniter 2/Doctrine 2 package</a></em></p> <h2 id="overview">Overview</h2> <p>CodeIgniter is a great PHP framework. The codebase is clean, the <a href="http://codeigniter.com/user_guide/">documentation</a> is fantastic, and it&#x2019;s regularly updated. Doctrine is a good ORM for the same reasons: it&#x2019;s very well-written, has <a href="http://www.doctrine-project.org/projects/orm/2.1/docs/en">extensive documentation</a>, and is actively developed. A combination of these two systems makes it easy to build database-oriented web applications quicker than ever before.</p> <p>To get started, download <a href="http://codeigniter.com/download.php">CodeIgniter 2</a> and <a href="http://www.doctrine-project.org/projects/orm.html">Doctrine 2</a> &#x2013; make sure you use the &#x2018;Download Archive&#x2019; link when downloading Doctrine.</p> <!--more--> <h2 id="setting-up-codeigniter">Setting up CodeIgniter</h2> <p>Put all of the CodeIgniter files into a directory on your web server, and configure it to your liking. If you need a guide on how to do this, the best place to look is the <a href="http://codeigniter.com/user_guide/">CodeIgniter User Guide</a>. Keep in mind that Doctrine will load the database configuration from CodeIgniter (<code class="highlighter-rouge">application/config/database.php</code>).</p> <h2 id="setting-up-doctrine">Setting up Doctrine</h2> <p>Because Doctrine is an entire system in itself, it worked well as a plugin for CodeIgniter 1. Unfortunately one of the major changes to CodeIgniter 2 is the removal of plugins. EllisLab recommends you refactor your plugins as libraries, so that&#x2019;s exactly what we will do.</p> <p>Setting up Doctrine as a CodeIgniter library is fairly simple:</p> <ol> <li>Put the Doctrine directory into application/libraries (so that you have a application/libraries/Doctrine directory).</li> <li>Create the file <code class="highlighter-rouge">application/libraries/Doctrine.php</code>. This will be our Doctrine bootstrap as well as the library that CodeIgniter loads.</li> <li>Copy the following code into <code class="highlighter-rouge">Doctrine.php</code>:</li> </ol> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Doctrine\Common\ClassLoader</span><span class="p">,</span>
    <span class="nx">Doctrine\ORM\Tools\Setup</span><span class="p">,</span>
    <span class="nx">Doctrine\ORM\EntityManager</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Doctrine</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$em</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">require_once</span> <span class="nx">__DIR__</span> <span class="o">.</span> <span class="s1">&apos;/Doctrine/ORM/Tools/Setup.php&apos;</span><span class="p">;</span>
        <span class="nx">Setup</span><span class="o">::</span><span class="na">registerAutoloadDirectory</span><span class="p">(</span><span class="nx">__DIR__</span><span class="p">);</span>

        <span class="c1">// Load the database configuration from CodeIgniter
</span>        <span class="k">require</span> <span class="nx">APPPATH</span> <span class="o">.</span> <span class="s1">&apos;config/database.php&apos;</span><span class="p">;</span>

        <span class="nv">$connection_options</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&apos;driver&apos;</span>        <span class="o">=&gt;</span> <span class="s1">&apos;pdo_mysql&apos;</span><span class="p">,</span>
            <span class="s1">&apos;user&apos;</span>          <span class="o">=&gt;</span> <span class="nv">$db</span><span class="p">[</span><span class="s1">&apos;default&apos;</span><span class="p">][</span><span class="s1">&apos;username&apos;</span><span class="p">],</span>
            <span class="s1">&apos;password&apos;</span>      <span class="o">=&gt;</span> <span class="nv">$db</span><span class="p">[</span><span class="s1">&apos;default&apos;</span><span class="p">][</span><span class="s1">&apos;password&apos;</span><span class="p">],</span>
            <span class="s1">&apos;host&apos;</span>          <span class="o">=&gt;</span> <span class="nv">$db</span><span class="p">[</span><span class="s1">&apos;default&apos;</span><span class="p">][</span><span class="s1">&apos;hostname&apos;</span><span class="p">],</span>
            <span class="s1">&apos;dbname&apos;</span>        <span class="o">=&gt;</span> <span class="nv">$db</span><span class="p">[</span><span class="s1">&apos;default&apos;</span><span class="p">][</span><span class="s1">&apos;database&apos;</span><span class="p">],</span>
            <span class="s1">&apos;charset&apos;</span>       <span class="o">=&gt;</span> <span class="nv">$db</span><span class="p">[</span><span class="s1">&apos;default&apos;</span><span class="p">][</span><span class="s1">&apos;char_set&apos;</span><span class="p">],</span>
            <span class="s1">&apos;driverOptions&apos;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">&apos;charset&apos;</span>   <span class="o">=&gt;</span> <span class="nv">$db</span><span class="p">[</span><span class="s1">&apos;default&apos;</span><span class="p">][</span><span class="s1">&apos;char_set&apos;</span><span class="p">],</span>
            <span class="p">),</span>
        <span class="p">);</span>

        <span class="c1">// With this configuration, your model files need to be in application/models/Entity
</span>        <span class="c1">// e.g. Creating a new Entity\User loads the class from application/models/Entity/User.php
</span>        <span class="nv">$models_namespace</span> <span class="o">=</span> <span class="s1">&apos;Entity&apos;</span><span class="p">;</span>
        <span class="nv">$models_path</span> <span class="o">=</span> <span class="nx">APPPATH</span> <span class="o">.</span> <span class="s1">&apos;models&apos;</span><span class="p">;</span>
        <span class="nv">$proxies_dir</span> <span class="o">=</span> <span class="nx">APPPATH</span> <span class="o">.</span> <span class="s1">&apos;models/Proxies&apos;</span><span class="p">;</span>
        <span class="nv">$metadata_paths</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="nx">APPPATH</span> <span class="o">.</span> <span class="s1">&apos;models&apos;</span><span class="p">);</span>

        <span class="c1">// Set $dev_mode to TRUE to disable caching while you develop
</span>        <span class="nv">$config</span> <span class="o">=</span> <span class="nx">Setup</span><span class="o">::</span><span class="na">createAnnotationMetadataConfiguration</span><span class="p">(</span><span class="nv">$metadata_paths</span><span class="p">,</span> <span class="nv">$dev_mode</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span> <span class="nv">$proxies_dir</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">em</span> <span class="o">=</span> <span class="nx">EntityManager</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="nv">$connection_options</span><span class="p">,</span> <span class="nv">$config</span><span class="p">);</span>

        <span class="nv">$loader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ClassLoader</span><span class="p">(</span><span class="nv">$models_namespace</span><span class="p">,</span> <span class="nv">$models_path</span><span class="p">);</span>
        <span class="nv">$loader</span><span class="o">-&gt;</span><span class="na">register</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>There are some parts of this file that you might like to modify to suit your needs:</p> <p><strong>Lines 34-37:</strong></p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$models_namespace</span> <span class="o">=</span> <span class="s1">&apos;Entity&apos;</span><span class="p">;</span>
<span class="nv">$models_path</span> <span class="o">=</span> <span class="nx">APPPATH</span> <span class="o">.</span> <span class="s1">&apos;models&apos;</span><span class="p">;</span>
<span class="nv">$proxies_dir</span> <span class="o">=</span> <span class="nx">APPPATH</span> <span class="o">.</span> <span class="s1">&apos;models/Proxies&apos;</span><span class="p">;</span>
<span class="nv">$metadata_paths</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="nx">APPPATH</span> <span class="o">.</span> <span class="s1">&apos;models&apos;</span><span class="p">);</span>
</code></pre></div></div> <p>These lines determine where you need to put your model files, and how you instantiate your model classes. With these settings, your models must live in <code class="highlighter-rouge">application/models/Entity</code> and be in the <code class="highlighter-rouge">Entity</code> namespace. For example instantiating a <code class="highlighter-rouge">new Entity\User</code> would load the User class from <code class="highlighter-rouge">application/models/Entity/User.php</code></p> <p><strong>Line 40</strong></p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$config</span> <span class="o">=</span> <span class="nx">Setup</span><span class="o">::</span><span class="na">createAnnotationMetadataConfiguration</span><span class="p">(</span><span class="nv">$metadata_paths</span><span class="p">,</span> <span class="nv">$dev_mode</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span> <span class="nv">$proxies_dir</span><span class="p">);</span>
</code></pre></div></div> <p>This line uses Doctrine&#x2019;s <code class="highlighter-rouge">Setup</code> class to automatically create the metadata configuration. The <a href="http://docs.doctrine-project.org/projects/doctrine-orm/en/latest/reference/metadata-drivers.html">Metadata Driver</a> is what Doctrine uses to interpret your models and map them to the database. In this tutorial I have used the <a href="http://docs.doctrine-project.org/projects/doctrine-orm/en/latest/reference/annotations-reference.html">Annotations Driver</a>. If you would like to use a different metadata driver, change <code class="highlighter-rouge">createAnnotationMetadataConfiguration</code> to one of the methods below:</p> <ul> <li><code class="highlighter-rouge">createXMLMetadataConfiguration</code> &#x2013; Uses the <a href="http://docs.doctrine-project.org/projects/doctrine-orm/en/latest/reference/xml-mapping.html">XML Mapping Driver</a></li> <li><code class="highlighter-rouge">createYAMLMetadataConfiguration</code> &#x2013; Uses the <a href="http://docs.doctrine-project.org/projects/doctrine-orm/en/latest/reference/yaml-mapping.html">YAML Mapping Driver</a></li> </ul> <p>Notice the <code class="highlighter-rouge">$dev_mode</code> variable. This should be true while you are developing, as it does a couple of things:</p> <ol> <li>Automatically generates your proxy classes</li> <li>Uses <code class="highlighter-rouge">ArrayCache</code>; a non-persistent caching class</li> </ol> <p>Likewise, when <code class="highlighter-rouge">$dev_mode</code> is false:</p> <ol> <li>Prevents your proxy classes from being overwritten</li> <li>Attempts to use one of the following persistent caches, in this order: APC, XCache, Memcache (127.0.0.1:11211), and Redis (127.0.0.1:6379)</li> </ol> <h2 id="advanced-configuration">Advanced Configuration</h2> <p>For more advanced configuration, read the <a href="http://docs.doctrine-project.org/projects/doctrine-orm/en/latest/reference/configuration.html">Configuration</a> section of the Doctrine documentation.</p> <h2 id="loading-doctrine">Loading Doctrine</h2> <p>Doctrine can now be loaded in the same way as any other CodeIgniter library:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">load</span><span class="o">-&gt;</span><span class="na">library</span><span class="p">(</span><span class="s1">&apos;doctrine&apos;</span><span class="p">);</span>
</code></pre></div></div> <p>Once the Doctrine library is loaded, you can retrieve the Entity Manage like so:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$em</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">doctrine</span><span class="o">-&gt;</span><span class="na">em</span><span class="p">;</span>
</code></pre></div></div> <h2 id="defining-models">Defining Models</h2> <p>Building models using the AnnotationDriver is simple. You can build your classes as if they were regular PHP classes, and define the Doctrine metadata in DocBlock annotations.</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Entity</span><span class="p">;</span>

<span class="sd">/**
 * @Entity
 * @Table(name=&quot;user&quot;)
 */</span>
<span class="k">class</span> <span class="nc">User</span>
<span class="p">{</span>
     <span class="c1">// ...
</span><span class="p">}</span>
</code></pre></div></div> <p>The <code class="highlighter-rouge">@Entity</code> annotation marks this class for <a href="http://docs.doctrine-project.org/projects/doctrine-orm/en/latest/reference/basic-mapping.html#persistent-classes">object-relational persistence</a>. If the table name is not specified (using the <code class="highlighter-rouge">@Table</code> annotation), Doctrine will create a table with the same name as the class.</p> <p>Annotations that you will probably use frequently are:</p> <ul> <li><code class="highlighter-rouge">@Column</code> &#x2013; Marks a property for object-relational persistence</li> <li><code class="highlighter-rouge">@OneToOne</code>,&#xA0;<code class="highlighter-rouge">@ManyToOne</code> and <code class="highlighter-rouge">@ManyToMany</code>&#xA0;&#x2013; Define a relationship between two entities</li> <li><code class="highlighter-rouge">@JoinTable</code> &#x2013; Used when defining a <code class="highlighter-rouge">@ManyToMany</code> relationship to specify the database join table</li> </ul> <p>For a full list of the available annotations and their uses, see the <a href="http://docs.doctrine-project.org/projects/doctrine-orm/en/latest/reference/annotations-reference.html">Annotation Reference</a></p> <p>Below are two sample entities that show a basic one-to-many relationship:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Entity</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Doctrine\Common\Collections\ArrayCollection</span><span class="p">;</span>

<span class="sd">/**
 * @Entity
 * @Table(name=&quot;user&quot;)
 */</span>
<span class="k">class</span> <span class="nc">User</span>
<span class="p">{</span>
    <span class="sd">/**
     * @Id
     * @Column(type=&quot;integer&quot;, nullable=false)
     * @GeneratedValue(strategy=&quot;AUTO&quot;)
     */</span>
    <span class="k">protected</span> <span class="nv">$id</span><span class="p">;</span>

    <span class="sd">/**
     * @Column(type=&quot;string&quot;, length=32, unique=true, nullable=false)
     */</span>
    <span class="k">protected</span> <span class="nv">$username</span><span class="p">;</span>

    <span class="sd">/**
     * @Column(type=&quot;string&quot;, length=64, nullable=false)
     */</span>
    <span class="k">protected</span> <span class="nv">$password</span><span class="p">;</span>

    <span class="sd">/**
     * @Column(type=&quot;string&quot;, length=255, unique=true, nullable=false)
     */</span>
    <span class="k">protected</span> <span class="nv">$email</span><span class="p">;</span>

    <span class="sd">/**
     * The @JoinColumn is not necessary in this example. When you do not specify
     * a @JoinColumn annotation, Doctrine will intelligently determine the join
     * column based on the entity class name and primary key.
     *
     * @ManyToOne(targetEntity=&quot;Group&quot;)
     * @JoinColumn(name=&quot;group_id&quot;, referencedColumnName=&quot;id&quot;)
     */</span>
    <span class="k">protected</span> <span class="nv">$group</span><span class="p">;</span>
<span class="p">}</span>

<span class="sd">/**
 * @Entity
 * @Table(name=&quot;group&quot;)
 */</span>
<span class="k">class</span> <span class="nc">Group</span>
<span class="p">{</span>
    <span class="sd">/**
     * @Id
     * @Column(type=&quot;integer&quot;, nullable=false)
     * @GeneratedValue(strategy=&quot;AUTO&quot;)
     */</span>
    <span class="k">protected</span> <span class="nv">$id</span><span class="p">;</span>

    <span class="sd">/**
     * @Column(type=&quot;string&quot;, length=32, unique=true, nullable=false)
     */</span>
    <span class="k">protected</span> <span class="nv">$name</span><span class="p">;</span>

    <span class="sd">/**
     * @OneToMany(targetEntity=&quot;User&quot;, mappedBy=&quot;group&quot;)
     */</span>
    <span class="k">protected</span> <span class="nv">$users</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <p>It is important to note that any mapped properties on your Entities need to be either <code class="highlighter-rouge">private</code> or <code class="highlighter-rouge">protected</code>, otherwise <a href="http://docs.doctrine-project.org/projects/doctrine-orm/en/latest/reference/architecture.html#entities">lazy-loading might not work as expected</a>. This means that it is necessary to use Java-styled getter and setter methods:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">function</span> <span class="nf">setUsername</span><span class="p">(</span><span class="nv">$username</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="nv">$username</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">function</span> <span class="nf">getUsername</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">username</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <p>Thankfully you can save a lot of time and <a href="https://wildlyinaccurate.com/useful-doctrine-2-console-commands#orm-generate-entities">automatically generate these methods</a> using the <code class="highlighter-rouge">orm:generate-entities</code> command.</p> <h2 id="setting-up-the-doctrine-console">Setting up the Doctrine Console</h2> <p>This step is optional, however the Doctrine Console has some very useful commands so I highly recommend setting it up.</p> <p>All you need to do is create the file <code class="highlighter-rouge">application/doctrine.php</code> and copy the following code into it:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="nb">define</span><span class="p">(</span><span class="s1">&apos;APPPATH&apos;</span><span class="p">,</span> <span class="nb">dirname</span><span class="p">(</span><span class="k">__FILE__</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&apos;/&apos;</span><span class="p">);</span>
<span class="nb">define</span><span class="p">(</span><span class="s1">&apos;BASEPATH&apos;</span><span class="p">,</span> <span class="nx">APPPATH</span> <span class="o">.</span> <span class="s1">&apos;/../system/&apos;</span><span class="p">);</span>
<span class="nb">define</span><span class="p">(</span><span class="s1">&apos;ENVIRONMENT&apos;</span><span class="p">,</span> <span class="s1">&apos;development&apos;</span><span class="p">);</span>

<span class="nb">chdir</span><span class="p">(</span><span class="nx">APPPATH</span><span class="p">);</span>

<span class="k">require</span> <span class="nx">__DIR__</span> <span class="o">.</span> <span class="s1">&apos;/libraries/Doctrine.php&apos;</span><span class="p">;</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$GLOBALS</span> <span class="k">as</span> <span class="nv">$helperSetCandidate</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$helperSetCandidate</span> <span class="nx">instanceof</span> <span class="nx">\Symfony\Component\Console\Helper\HelperSet</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$helperSet</span> <span class="o">=</span> <span class="nv">$helperSetCandidate</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nv">$doctrine</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Doctrine</span><span class="p">;</span>
<span class="nv">$em</span> <span class="o">=</span> <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">em</span><span class="p">;</span>

<span class="nv">$helperSet</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Symfony\Component\Console\Helper\HelperSet</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="s1">&apos;db&apos;</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">\Doctrine\DBAL\Tools\Console\Helper\ConnectionHelper</span><span class="p">(</span><span class="nv">$em</span><span class="o">-&gt;</span><span class="na">getConnection</span><span class="p">()),</span>
    <span class="s1">&apos;em&apos;</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">\Doctrine\ORM\Tools\Console\Helper\EntityManagerHelper</span><span class="p">(</span><span class="nv">$em</span><span class="p">)</span>
<span class="p">));</span>

<span class="nx">\Doctrine\ORM\Tools\Console\ConsoleRunner</span><span class="o">::</span><span class="na">run</span><span class="p">(</span><span class="nv">$helperSet</span><span class="p">);</span>
</code></pre></div></div> <p>On a Linux or Mac, you can now run <code class="highlighter-rouge">./application/doctrine</code> from the command line.</p> <p>If you are on Windows, you can run <code class="highlighter-rouge">php.exe application/doctrine.php</code> from the command line. If you are new to running PHP scripts from the command line in Windows, you may want to read <a href="http://php.net/manual/en/install.windows.commandline.php">PHP&#x2019;s documentation</a>.</p> <h2 id="using-the-doctrine-console">Using the Doctrine Console</h2> <p>If you run the Doctrine console with no arguments, you will be presented with a list of the available commands. For now, we are only interested in the <code class="highlighter-rouge">orm:schema-tool</code> commands. If you would like to learn about the other commands you can run a command with the <code class="highlighter-rouge">--help</code> flag or read my quick <a href="https://wildlyinaccurate.com/useful-doctrine-2-console-commands">Doctrine console overview</a>.</p> <p><code class="highlighter-rouge">orm:schema-tool:create</code> will create tables in your database based on your Doctrine models.</p> <p><code class="highlighter-rouge">orm:schema-tool:drop</code> will do the exact opposite. It is worth noting that this command will only drop tables which have correlating Doctrine models. Any tables that aren&#x2019;t mapped to a Doctrine model will be left alone.</p> <p><code class="highlighter-rouge">orm:schema-tool:update</code> will determine if your database schema is out-of-date, and give you the option of updating it. You can execute this command with the <code class="highlighter-rouge">--dump-sql</code> flag to see the changes, or the <code class="highlighter-rouge">--force</code> flag to execute the changes.</p> <h2 id="using-doctrine">Using Doctrine</h2> <p>Once your models are set up and your database is built, you can access your models using the Doctrine EntityManager. I like shortcuts, so I always instantiate the <code class="highlighter-rouge">EntityManager</code> in <code class="highlighter-rouge">MY_Controller</code>:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">MY_Controller</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="c1">// Doctrine EntityManager
</span>    <span class="k">public</span> <span class="nv">$em</span><span class="p">;</span>

    <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">__construct</span><span class="p">();</span>

        <span class="c1">// Not required if you autoload the library
</span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">load</span><span class="o">-&gt;</span><span class="na">library</span><span class="p">(</span><span class="s1">&apos;doctrine&apos;</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">em</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">doctrine</span><span class="o">-&gt;</span><span class="na">em</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>Instead of the longer <code class="highlighter-rouge">$this-&gt;doctrine-&gt;em</code>, this will allow you to access the EntityManager using <code class="highlighter-rouge">$this-&gt;em</code>:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Entity\User</span><span class="p">;</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setUsername</span><span class="p">(</span><span class="s1">&apos;Joseph&apos;</span><span class="p">);</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="s1">&apos;secretPassw0rd&apos;</span><span class="p">);</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setEmail</span><span class="p">(</span><span class="s1">&apos;josephatwildlyinaccuratedotcom&apos;</span><span class="p">);</span>

<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">em</span><span class="o">-&gt;</span><span class="na">persist</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">em</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
</code></pre></div></div> <h2 id="final-words">Final Words</h2> <p>If you have been spoiled by Doctrine 1&#x2019;s magic then you will probably have a hard time wrapping your head around Doctrine 2&#x2019;s strict object-oriented approach to everything. When learning your way around a new system, documentation can be your best friend or your worst enemy. Lucky for us, the Doctrine team has written some fantastic documentation. If you are having trouble getting something to work, one of the first things you should do is <abbr title="Read The Manual">RTFM</abbr> (<a href="http://docs.doctrine-project.org/projects/doctrine-orm/en/latest/index.html">Doctrine</a>; <a href="http://codeigniter.com/user_guide/">CodeIgniter</a>).</p> <p>Good luck, I hope you enjoy using these powerful tools!</p> </article> <div class="wrap pt-4"> <p> <i>Have any questions or comments? Feel free to reach out on Twitter: <a href="https://twitter.com/Joseph_Wynn">@Joseph_Wynn</a></i> </p> <small> <blockquote> <p>This post was published on <b>26 September, 2010</b> and last updated on <b>24 July, 2016</b>. It was posted in [<a href="/category/CodeIgniter/">CodeIgniter</a>, <a href="/category/Doctrine/">Doctrine</a>, <a href="/category/PHP/">PHP</a>, <a href="/category/Web Development/">Web Development</a>] and tagged with [<a href="/tag/codeigniter 2/">codeigniter 2</a>, <a href="/tag/combine/">combine</a>, <a href="/tag/doctrine 2/">doctrine 2</a>, <a href="/tag/guide/">guide</a>] </p> </blockquote> </small> </div> <footer class="wrap mw-w mt-5 pt-4"> <ul class="ls-n f-r"> <li> <a href="https://github.com/wildlyinaccurate"> <span class="d-ib va-m w-4 h-4"> <svg viewbox="0 0 16 16"> <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/> </svg> </span> <span>wildlyinaccurate</span> </a> </li> <li> <a href="https://twitter.com/joseph_wynn"> <span class="d-ib va-m w-4 h-4"> <svg viewbox="0 0 16 16"> <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                        c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/> </svg> </span> <span>joseph_wynn</span> </a> </li> </ul> <small> <i>A collection of guides &amp; opinions about programming and the state of the web. </i> </small> </footer> <script> if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/service-worker.js')
            }

            
            window.LUX = {
                label: 'article'
            } </script> <script src="https://cdn.speedcurve.com/js/lux.js?id=73376842" async defer="defer"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-20744182-3', { siteSpeedSampleRate: 100 });
            ga('send', 'pageview'); </script> <script> (function() {
                var s, p, n, a;

                s = document.createElement('script');
                s.async = 1;
                s.defer = 1;
                s.src = 'https://cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=wildlyinaccuratecom';
                s.id = '_carbonads_js';

                p = document.createElement('small');
                p.className = 'ta-c';
                p.appendChild(s);

                n = document.querySelector('article > p:nth-of-type(3)');

                if (n) {
                    n.parentNode.insertBefore(p, n.nextSibling);
                } else {
                    n = document.getElementsByTagName('article')[0];
                    n.parentNode.insertBefore(p, n.nextSibling);
                }
            })(); </script> </body> </html> 