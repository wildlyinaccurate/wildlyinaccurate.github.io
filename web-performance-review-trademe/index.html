<!doctype html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width,initial-scale=1"> <meta name="theme-color" content="#8e44ad"> <title>Web performance review: TradeMe | Wildly Inaccurate</title> <meta name="description" content="Most of the English-speaking world has Amazon and eBay. In New Zealand we have TradeMe - an online auction &amp; classified advert website where Kiwis go to buy &amp; sell general items, cars, and property. If the numbers are to be believed, then ..."> <style>img,svg{vertical-align:middle}ol,p,pre,table,ul{margin-bottom:1rem}a,table{background-color:transparent}ol,p,pre,ul{margin-top:0}#carbonads,article,footer,header,nav,section{display:block}a:active,a:hover{outline-width:0}svg:not(:root){overflow:hidden}*,::after,::before{box-sizing:border-box}html{font-family:sans-serif;line-height:1.15;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;-ms-overflow-style:scrollbar;-webkit-tap-highlight-color:transparent}@-ms-viewport{width:device-width}body{margin:0;font-family:serif;font-size:1.12rem;font-weight:400;line-height:1.5;color:#212529;text-align:left;background-color:#fff}ul ul{margin-bottom:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:80%}a{color:#7700a8;text-decoration:none;-webkit-text-decoration-skip:objects}a:hover{color:#41005c;text-decoration:underline}code,pre{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}pre{overflow:auto;-ms-overflow-style:scrollbar;padding:1rem}img{border-style:none;max-width:100%;height:auto}svg{overflow:hidden}table{border-collapse:collapse;width:100%}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}.btn,h1,h2,h3,h4,h5{font-family:sans-serif}h1,h2,h3,h4,h5{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2;color:inherit}h1{font-size:2.8rem}h2{font-size:2.24rem}h3{font-size:1.848rem}h4{font-size:1.68rem}h5{font-size:1.4rem}small{font-weight:400}table td{padding:.75rem;vertical-align:top}table,table td{border:1px solid #dee2e6}#carbonads{margin:1rem auto;max-width:200px}.mb-4,.my-4{margin-bottom:1.5rem}.carbon-poweredby,.carbon-text{color:#6c757d;display:block;margin-top:.5rem}.btn,.d-ib{display:inline-block}blockquote{border-left:5px solid #7700a8;padding:1rem 2rem 1px}.btn{background:#7700a8;color:#fff}.btn:focus,.btn:hover{background:rgba(119,0,168,.8);color:#fff}.btn--inverse{background:rgba(255,255,255,.67);color:#7700a8}.btn--inverse:focus,.btn--inverse:hover{background:rgba(255,255,255,.4)}code,pre{background:#f8f9fa;font-size:87.5%}code{padding:.3333333333rem .5rem;white-space:pre-wrap}pre code{padding:0}[class*=language-] pre,[class*=language-] pre code{background:#212529}footer{border-top:1px solid #6c757d}.post-content>*,.wrap{width:100%;padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto;max-width:960px;max-width:1140px}@media (min-width:576px){.post-content>*,.wrap{max-width:540px}}@media (min-width:768px){.post-content>*,.wrap{max-width:720px}}.post-content>ol,.post-content>ul{padding-left:45px}.outset{width:1280px;max-width:90%}@media (max-width:767.98px){.outset{max-width:100%}}.ls-n{list-style:none}h2{margin-top:1.5rem}h3{margin-top:1rem}.page-header{color:#fff;min-height:240px;overflow:hidden;position:relative;text-shadow:-1px 0 1px #000}.page-header a{color:#fff}.va-m{vertical-align:middle}.c-gl{color:#6c757d}.z-1{z-index:1}.z--1{z-index:-1}.f-r{float:right}.pos-a{position:absolute}.b-0{bottom:0}.h-100{height:100%}.h-4{height:1.5rem}.w-100{width:100%}.w-4{width:1.5rem}@media (min-width:768px){.h-md-a{height:auto}}.mw-w{max-width:880px}.mw-n{max-width:none}.my-4{margin-top:1.5rem}.mt-5{margin-top:3rem}.p-2{padding:.5rem}.pt-2{padding-top:.5rem}.p-3{padding:1rem}.pb-3{padding-bottom:1rem}.pt-4{padding-top:1.5rem}.pt-5{padding-top:3rem}@media (min-width:576px){.p-sm-3{padding:1rem}}.ta-c{text-align:center}</style> <link rel="manifest" href="/manifest.json"> <link rel="canonical" href="https://wildlyinaccurate.com/web-performance-review-trademe"> <link rel="alternate" type="application/atom+xml" title="Wildly Inaccurate" href="https://wildlyinaccurate.com/feed.xml"> <style>#markdown-toc{background:#f8f9fa;border:1px solid #6c757d;display:table;font-size:1rem;padding:1rem 1rem 1rem 3rem}#markdown-toc,#markdown-toc ul{list-style:decimal}#markdown-toc:before{content:'Contents';display:block;font-weight:700;margin-bottom:.5rem;margin-left:-2rem}</style> </head> <body> <nav class="pos-a w-100 z-1"> <div class="wrap mw-w"> <a class="btn p-2 p-sm-3" href="https://wildlyinaccurate.com">Wildly Inaccurate</a> <div class="f-r"> <a class="btn btn--inverse p-2 p-sm-3" href="/about/">About</a> <a class="btn btn--inverse p-2 p-sm-3" href="/projects/">Projects</a> <a class="btn btn--inverse p-2 p-sm-3" href="/search/">Search</a> </div> </div> </nav> <header class="page-header mb-4"> <img class="pos-a b-0 h-100 mw-n h-md-a z--1" src="/assets/dfi.jpg" srcset="/assets/r/330/dfi.jpg 330w, /assets/r/345/dfi.jpg 345w, /assets/r/381/dfi.jpg 381w, /assets/r/384/dfi.jpg 384w, /assets/r/546/dfi.jpg 546w, /assets/r/640/dfi.jpg 640w, /assets/r/738/dfi.jpg 738w, /assets/r/840/dfi.jpg 840w, /assets/r/960/dfi.jpg 960w, /assets/r/1250/dfi.jpg 1250w, /assets/r/1366/dfi.jpg 1366w, /assets/r/1440/dfi.jpg 1440w, /assets/r/1680/dfi.jpg 1680w, /assets/dfi.jpg 2600w"> <div class="wrap mw-w mt-5 pt-2"> <h1 class="mt-5">Web performance review: TradeMe</h1> <p class="pt-2 pt-lg-4"> Aug 22, 2018 &#x2022; 15 minute read &#x2022; posted in [ <a href="/category/Performance/">Performance</a>, <a href="/category/Web Development/">Web Development</a> ] </p> </div> </header> <article class="post-content"> <p>Most of the English-speaking world has Amazon and eBay. In New Zealand we have TradeMe - an online auction &amp; classified advert website where Kiwis go to buy &amp; sell general items, cars, and property. If the numbers are to be believed, then pretty much every Kiwi has a TradeMe account. I don&#x2019;t think it&#x2019;s an understatement to say that TradeMe is an itegral part of modern New Zealand culture.</p> <p>Back in 2016, <a href="https://investors.trademe.co.nz/media/75789/5-F16-Investor-presentation.pdf">TradeMe announced</a> that it was working on a new &#x201C;smartphone-optimised&#x201D; responsive website that will eventually also replace the desktop website. Then halfway through 2018, they announced that the new responsive website was being rolled out to real users.</p> <p>Being the ever-curious developer, I wanted to give the new TradeMe website a try. After a couple of weeks using the new website on my phone (a Nokia 7 Plus), I became frustrated with how much time I spent staring at a loading spinner, and how sluggish the UI interactions were. So I went back to the old website.</p> <div class="my-4 ta-c outset"> <img alt="The loading screen for the new TradeMe website" src="/assets/trademe-preview-loading.png" width="400" srcset="/assets/r/330/trademe-preview-loading.png 330w, /assets/r/345/trademe-preview-loading.png 345w, /assets/r/381/trademe-preview-loading.png 381w, /assets/r/384/trademe-preview-loading.png 384w, /assets/trademe-preview-loading.png 400w"> <div class="c-gl caption"> <small><i>The loading screen for the new TradeMe website</i></small> </div> </div> <p>This bothered me, because I know that the other TradeMe experiences are fast. Why should this new website be so slow? I wanted to dig deeper, so I&#x2019;ve taken the opportunity to conduct a detailed performance review.<!--more--></p> <ul id="markdown-toc"> <li><a href="#defining-the-test-parameters" id="markdown-toc-defining-the-test-parameters">Defining the test parameters</a></li> <li><a href="#the-benchmark" id="markdown-toc-the-benchmark">The benchmark</a></li> <li><a href="#identifying-performance-bottlenecks" id="markdown-toc-identifying-performance-bottlenecks">Identifying performance bottlenecks</a> <ul> <li><a href="#main-thread-activity" id="markdown-toc-main-thread-activity">Main thread activity</a></li> <li><a href="#delayed-primary-image-request" id="markdown-toc-delayed-primary-image-request">Delayed primary image request</a></li> </ul> </li> <li><a href="#some-performance-experiments" id="markdown-toc-some-performance-experiments">Some performance experiments</a> <ul> <li><a href="#prioritise-loading-the-primary-image" id="markdown-toc-prioritise-loading-the-primary-image">Prioritise loading the primary image</a></li> <li><a href="#defer-loading-third-party-assets" id="markdown-toc-defer-loading-third-party-assets">Defer loading third party assets</a></li> <li><a href="#render-page-content-on-the-server" id="markdown-toc-render-page-content-on-the-server">Render page content on the server</a></li> </ul> </li> <li><a href="#causes-for-celebration-" id="markdown-toc-causes-for-celebration-">Causes for celebration &#x1F389;</a> <ul> <li><a href="#caching-improves-the-experience-on-repeat-visits" id="markdown-toc-caching-improves-the-experience-on-repeat-visits">Caching improves the experience on repeat visits</a></li> <li><a href="#code-splitting-is-already-implemented" id="markdown-toc-code-splitting-is-already-implemented">Code splitting is already implemented</a></li> </ul> </li> <li><a href="#recommendations" id="markdown-toc-recommendations">Recommendations</a> <ul> <li><a href="#test-on-representative-devices-and-networks" id="markdown-toc-test-on-representative-devices-and-networks">Test on representative devices and networks</a></li> <li><a href="#render-the-core-content-on-the-server" id="markdown-toc-render-the-core-content-on-the-server">Render the core content on the server</a></li> <li><a href="#reduce-the-amount-of-javascript-you-ship" id="markdown-toc-reduce-the-amount-of-javascript-you-ship">Reduce the amount of JavaScript you ship</a></li> <li><a href="#use-performance-budgets" id="markdown-toc-use-performance-budgets">Use performance budgets</a></li> </ul> </li> <li><a href="#wrapping-up" id="markdown-toc-wrapping-up">Wrapping up</a></li> </ul> <h2 id="defining-the-test-parameters">Defining the test parameters</h2> <p>One of the first things I like to do when I&#x2019;m assessing the performance of a website is set a benchmark &#x2013; what do users <em>expect</em> from this website? In most cases it makes sense to use a competing website as the benchmark. When we were <a href="/introducing-a-faster-bbc-news-front-page/">improving the performance of BBC News</a>, we used The Guardian and Financial Times as our benchmark because they are two of the fastest websites in the industry. However, it isn&#x2019;t fair to use eBay or Amazon as a benchmark for TradeMe because they are both multi-billion dollar companies with thousands of developers. Instead, I&#x2019;m using the much older (but much faster) TradeMe Touch website as a benchmark.</p> <p>The next thing I like to do is find some performance metrics that are representative of the user experience. Given that TradeMe is mostly used by buyers (as opposed to sellers), I focused on visual completeness (<em>when can I see the thing I&#x2019;m trying to buy?</em>) and interactivity (<em>when can I scroll and place a bid?</em>). Both of these things are very easy to measure with <a href="https://www.webpagetest.org/">WebPageTest</a>:</p> <ul> <li>I measure visual completeness by looking for the point at which the primary image is loaded using <a href="https://github.com/WPO-Foundation/webpagetest/blob/master/docs/Metrics/HeroElements.md">hero element times</a> (which are currently hidden behind the <a href="https://www.webpagetest.org/?heroElementTimes=1">heroElementTimes flag</a>).</li> <li>I measure interactivity by using <a href="https://github.com/WPO-Foundation/webpagetest/blob/master/docs/Metrics/TimeToInteractive.md">WebPageTest&#x2019;s Time to Interactive metric</a>, which is calculated as the point when the main thread has not been blocked for 5 seconds.</li> </ul> <p>The final parameter is the test configuration. I wanted to emulate the performance of a mid-range smartphone on a mobile data connection, so for all of these tests I used the following WebPageTest configuration:</p> <ul> <li><strong>Test Location:</strong> Sydney, Australia - EC2</li> <li><strong>Browser:</strong> Chrome</li> <li><strong>Connection:</strong> 3G (1.6 Mbps/768 Kbps 300ms RTT)</li> <li><strong>Emulate Mobile Browser:</strong> iPhone 6/7/8</li> <li><strong>CPU Throttling:</strong> 2.6 (specified using the <a href="https://www.webpagetest.org/?throttle_cpu=2.6">throttle_cpu flag</a>)</li> </ul> <p>I ran all of these tests through <a href="https://speedcurve.com/">SpeedCurve</a>, which uses WebPageTest under the hood. I did this because SpeedCurve simplifies the process of running multiple tests and comparing data across different page variations. It also has some nice charts &amp; views that make it easier to interpret the data.</p> <h2 id="the-benchmark">The benchmark</h2> <p>First up is the old TradeMe Touch website. In the screenshot below, you can see two metrics are highlighted: First Interactive and Largest Image Render. The page is considered interactive at <strong>7.2 seconds</strong>, and the primary image is rendered at <strong>14.9 seconds</strong>. The interactive time is not bad for a mid-range mobile device, but having to wait nearly 15 seconds to see the primary content is not something that most users will be happy about. I know I said that I wouldn&#x2019;t compare TradeMe to its better-resourced international competitors, but just for reference: a similar page on eBay renders the primary image at <strong>5.3 seconds</strong>.</p> <div class="my-4 ta-c outset"> <img alt="A waterfall chart showing the timeline of a TradeMe Touch listing page" src="/assets/trademe-touch-iphone-6.png" srcset="/assets/r/330/trademe-touch-iphone-6.png 330w, /assets/r/345/trademe-touch-iphone-6.png 345w, /assets/r/381/trademe-touch-iphone-6.png 381w, /assets/r/384/trademe-touch-iphone-6.png 384w, /assets/r/546/trademe-touch-iphone-6.png 546w, /assets/r/640/trademe-touch-iphone-6.png 640w, /assets/r/738/trademe-touch-iphone-6.png 738w, /assets/r/840/trademe-touch-iphone-6.png 840w, /assets/r/960/trademe-touch-iphone-6.png 960w, /assets/r/1250/trademe-touch-iphone-6.png 1250w"> <div class="c-gl caption"> <small><i>A waterfall chart showing the timeline of a TradeMe Touch listing page</i></small> </div> </div> <p>Now let&#x2019;s see how the new website performs: interactive at <strong>11.6 seconds</strong>, and the primary image is rendered at <strong>30.4 seconds</strong>. No wonder I felt frustrated using this new website! On the bright side, there&#x2019;s plenty of good performance lessons we can learn from this review. So let&#x2019;s dig a bit deeper.</p> <div class="my-4 ta-c outset"> <img alt="A waterfall chart showing the timeline of a TradeMe Preview listing page" src="/assets/trademe-preview-iphone-6.png" srcset="/assets/r/330/trademe-preview-iphone-6.png 330w, /assets/r/345/trademe-preview-iphone-6.png 345w, /assets/r/381/trademe-preview-iphone-6.png 381w, /assets/r/384/trademe-preview-iphone-6.png 384w, /assets/r/546/trademe-preview-iphone-6.png 546w, /assets/r/640/trademe-preview-iphone-6.png 640w, /assets/r/738/trademe-preview-iphone-6.png 738w, /assets/r/840/trademe-preview-iphone-6.png 840w, /assets/r/960/trademe-preview-iphone-6.png 960w, /assets/r/1250/trademe-preview-iphone-6.png 1250w"> <div class="c-gl caption"> <small><i>A waterfall chart showing the timeline of a TradeMe Preview listing page</i></small> </div> </div> <h2 id="identifying-performance-bottlenecks">Identifying performance bottlenecks</h2> <h3 id="main-thread-activity">Main thread activity</h3> <p>The first thing that draws my eye is this 2-second slice where the main thread is busy evaluating JavaScript. During these 2 seconds, the browser is doing nothing else. No layouts, no painting, not even any network requests.</p> <div class="my-4 ta-c outset"> <img alt="JavaScript is blocking the main thread for 2 seconds at this point in the timeline" src="/assets/trademe-preview-iphone-6-main-thread.png" width="657" srcset="/assets/r/330/trademe-preview-iphone-6-main-thread.png 330w, /assets/r/345/trademe-preview-iphone-6-main-thread.png 345w, /assets/r/381/trademe-preview-iphone-6-main-thread.png 381w, /assets/r/384/trademe-preview-iphone-6-main-thread.png 384w, /assets/r/546/trademe-preview-iphone-6-main-thread.png 546w, /assets/r/640/trademe-preview-iphone-6-main-thread.png 640w, /assets/trademe-preview-iphone-6-main-thread.png 657w"> <div class="c-gl caption"> <small><i>JavaScript is blocking the main thread for 2 seconds at this point in the timeline</i></small> </div> </div> <p>When I open the network view, it&#x2019;s obvious what&#x2019;s causing this: the browser is evaluating the <strong>716KB of JavaScript</strong> that it just downloaded. This number is the bytes that were sent over the network, and doesn&#x2019;t represent the true cost of this JavaScript. Once uncompressed, these JavaScript files weigh in at over <strong>2.7MB</strong>. (Tip: in the Network tab of Firefox DevTools, you can choose to show both the &#x201C;Transferred&#x201D; and &#x201C;Size&#x201D; columns so that you can see both the bytes over the wire and the raw uncompressed resource size).</p> <div class="my-4 ta-c outset"> <img alt="Large JavaScript requests in the network view" src="/assets/trademe-preview-iphone-6-network-js.png" width="727" srcset="/assets/r/330/trademe-preview-iphone-6-network-js.png 330w, /assets/r/345/trademe-preview-iphone-6-network-js.png 345w, /assets/r/381/trademe-preview-iphone-6-network-js.png 381w, /assets/r/384/trademe-preview-iphone-6-network-js.png 384w, /assets/r/546/trademe-preview-iphone-6-network-js.png 546w, /assets/r/640/trademe-preview-iphone-6-network-js.png 640w, /assets/trademe-preview-iphone-6-network-js.png 727w"> <div class="c-gl caption"> <small><i>Large JavaScript requests in the network view</i></small> </div> </div> <p>This 2 second period is just the tip of the iceberg. By the time the page has finished loading, over <strong>2.2MB</strong> of JavaScript has been downloaded. This expands to more than <strong>5.1MB</strong> of uncompressed code that the browser must parse, compile, and execute. According to the Coverage tool in Chrome DevTools, 3MB of this code is never even executed during the page load.</p> <div class="my-4 ta-c outset"> <img alt="Coverage report in Chrome DevTools" src="/assets/trademe-preview-chrome-coverage.png" srcset="/assets/r/330/trademe-preview-chrome-coverage.png 330w, /assets/r/345/trademe-preview-chrome-coverage.png 345w, /assets/r/381/trademe-preview-chrome-coverage.png 381w, /assets/r/384/trademe-preview-chrome-coverage.png 384w, /assets/r/546/trademe-preview-chrome-coverage.png 546w, /assets/r/640/trademe-preview-chrome-coverage.png 640w, /assets/r/738/trademe-preview-chrome-coverage.png 738w, /assets/r/840/trademe-preview-chrome-coverage.png 840w, /assets/r/960/trademe-preview-chrome-coverage.png 960w, /assets/r/1250/trademe-preview-chrome-coverage.png 1250w"> <div class="c-gl caption"> <small><i>Coverage report in Chrome DevTools</i></small> </div> </div> <h3 id="delayed-primary-image-request">Delayed primary image request</h3> <p>The second thing that draws my attention is that the network request for the primary image does not even start until the 30 second mark. It&#x2019;s request #107, out of 195 total requests. 17 other large images are downloaded before the primary image, which quickly uses up the limited bandwidth of this simulated mobile connection.</p> <div class="my-4 ta-c outset"> <img alt="Waterfall chart showing the number of requests before the primary image is rendered" src="/assets/trademe-preview-primary-image-requests.png" srcset="/assets/r/330/trademe-preview-primary-image-requests.png 330w, /assets/r/345/trademe-preview-primary-image-requests.png 345w, /assets/r/381/trademe-preview-primary-image-requests.png 381w, /assets/r/384/trademe-preview-primary-image-requests.png 384w, /assets/r/546/trademe-preview-primary-image-requests.png 546w, /assets/r/640/trademe-preview-primary-image-requests.png 640w, /assets/r/738/trademe-preview-primary-image-requests.png 738w, /assets/r/840/trademe-preview-primary-image-requests.png 840w, /assets/r/960/trademe-preview-primary-image-requests.png 960w, /assets/r/1250/trademe-preview-primary-image-requests.png 1250w"> <div class="c-gl caption"> <small><i>Waterfall chart showing the number of requests before the primary image is rendered</i></small> </div> </div> <h2 id="some-performance-experiments">Some performance experiments</h2> <p>Looking at waterfall charts and dissecting JavaScript bundles is interesting, but what we really want to get out of a performance review is a list of actionable tasks with a rough estimate of how each task will impact the performance of the website. One of my favourite ways to get this list is by running some <a href="/using-ab-testing-to-prioritise-performance-optimisations/">A/B performance tests</a> by making some optimisations by hand and measuring their impact.</p> <h3 id="prioritise-loading-the-primary-image">Prioritise loading the primary image</h3> <p>One of the obvious bottlenecks is the primary image being downloaded so far through the page load. We can improve the user experience by prioritising the primary image. I simulated this optimisation in two steps:</p> <ol> <li>Prime the cache for the primary image. While this is not strictly possible in the real world, the effect should be similar to using <code class="highlighter-rouge">&lt;link rel=preload&gt;</code> to request the primary image as soon as possible.</li> <li>Block all of the other image requests so that the primary image isn&#x2019;t contending for network bandwidth.</li> </ol> <p>Here are the results:</p> <table> <thead> <tr> <th>Metric</th> <th>Original</th> <th>Optimised</th> <th>Difference</th> </tr> </thead> <tbody> <tr> <td>Primary image render</td> <td><strong>30.4s</strong></td> <td><strong>21s</strong></td> <td><strong>9.4s</strong> (30%)</td> </tr> </tbody> </table> <p>Viewing the filmstrip of the original page versus the optimised page really shows how much faster this is:</p> <div class="my-4 ta-c outset"> <img alt="A filmstrip comparison of the original page (top) versus the optimised page (bottom). Frame interval: 2500ms" src="/assets/trademe-preview-image-optimisation-filmstrip.png" srcset="/assets/r/330/trademe-preview-image-optimisation-filmstrip.png 330w, /assets/r/345/trademe-preview-image-optimisation-filmstrip.png 345w, /assets/r/381/trademe-preview-image-optimisation-filmstrip.png 381w, /assets/r/384/trademe-preview-image-optimisation-filmstrip.png 384w, /assets/r/546/trademe-preview-image-optimisation-filmstrip.png 546w, /assets/r/640/trademe-preview-image-optimisation-filmstrip.png 640w, /assets/r/738/trademe-preview-image-optimisation-filmstrip.png 738w, /assets/r/840/trademe-preview-image-optimisation-filmstrip.png 840w, /assets/r/960/trademe-preview-image-optimisation-filmstrip.png 960w, /assets/r/1250/trademe-preview-image-optimisation-filmstrip.png 1250w"> <div class="c-gl caption"> <small><i>A filmstrip comparison of the original page (top) versus the optimised page (bottom). Frame interval: 2500ms</i></small> </div> </div> <h3 id="defer-loading-third-party-assets">Defer loading third party assets</h3> <p>While the majority of the blocking assets belong to TradeMe, there is still a considerable amount of third party content being downloaded &#x2013; about 350KB, most of which is JavaScript. Deferring this third party content until later in the page load could improve the user experience by prioritising the first party content.</p> <p>I simulated this optimisation by blocking requests from all third party domains. Here are the results:</p> <table> <thead> <tr> <th>Metric</th> <th>Original</th> <th>Optimised</th> <th>Difference</th> </tr> </thead> <tbody> <tr> <td>First Interactive</td> <td><strong>11.6s</strong></td> <td><strong>9.5s</strong></td> <td><strong>2.1s</strong> (18%)</td> </tr> </tbody> </table> <h3 id="render-page-content-on-the-server">Render page content on the server</h3> <p>Unfortunately the new TradeMe site neither works without JavaScript enabled, nor does it work offline despite utilising a caching service worker. One reason for this is that the page content is fetched and rendered by JavaScript rather than being contained in the initial document response. Rendering some basic content on the server not only enables the page to be used offline or without JavaScript, it also has significant performance benefits since the browser can begin to render content well before it has finished downloading the other page resources.</p> <p>I simulated this optimisation by creating a static version of the page with the content pre-rendered. I also moved the <code class="highlighter-rouge">&lt;script&gt;</code> tags to below the main content to prevent them from blocking rendering. Since this version ran in a different environment, I adjust the numbers to account for the difference in backend times. Here are the results:</p> <table> <thead> <tr> <th>Metric</th> <th>Original</th> <th>Optimised</th> <th>Difference</th> </tr> </thead> <tbody> <tr> <td>Heading render</td> <td><strong>21.2s</strong></td> <td><strong>5.7s</strong></td> <td><strong>15.5s</strong> (73%)</td> </tr> <tr> <td>Primary image render</td> <td><strong>30.4s</strong></td> <td><strong>11.7s</strong></td> <td><strong>18.7s</strong> (61%)</td> </tr> </tbody> </table> <p>Like the primary image optimisation test, viewing the filmstrip of the original page versus the optimised page shows how much impact this optimisation really has.</p> <div class="my-4 ta-c outset"> <img alt="A filmstrip comparison of the original page (top) versus the optimised page (bottom). Frame interval: 2500ms." src="/assets/trademe-preview-server-render-filmstrip.png" srcset="/assets/r/330/trademe-preview-server-render-filmstrip.png 330w, /assets/r/345/trademe-preview-server-render-filmstrip.png 345w, /assets/r/381/trademe-preview-server-render-filmstrip.png 381w, /assets/r/384/trademe-preview-server-render-filmstrip.png 384w, /assets/r/546/trademe-preview-server-render-filmstrip.png 546w, /assets/r/640/trademe-preview-server-render-filmstrip.png 640w, /assets/r/738/trademe-preview-server-render-filmstrip.png 738w, /assets/r/840/trademe-preview-server-render-filmstrip.png 840w, /assets/r/960/trademe-preview-server-render-filmstrip.png 960w, /assets/r/1250/trademe-preview-server-render-filmstrip.png 1250w"> <div class="c-gl caption"> <small><i>A filmstrip comparison of the original page (top) versus the optimised page (bottom). Frame interval: 2500ms.</i></small> </div> </div> <p>Note that First Interactive is not comparable for this test, since I changed the position of the <code class="highlighter-rouge">&lt;script&gt;</code> tags.</p> <h2 id="causes-for-celebration-">Causes for celebration &#x1F389;</h2> <p>It&#x2019;s far too easy in a performance review to focus on the things that a website gets wrong. I always like to try and find some things that a website is doing right.</p> <h3 id="caching-improves-the-experience-on-repeat-visits">Caching improves the experience on repeat visits</h3> <p>On the first page load, over 4.2MB of data is transferred. On subsequent page loads, that number is more like 570KB thanks to a caching service worker and sensible caching headers.</p> <h3 id="code-splitting-is-already-implemented">Code splitting is already implemented</h3> <p>Despite the massive bundle size, it looks like code splitting has already been implemented. <a href="https://developers.google.com/web/fundamentals/performance/optimizing-javascript/code-splitting/">Code splitting is recommended</a> to ensure that your users only download the code that they need. Code splitting can be hard, but the fact that it is already set up on TradeMe should reduce the amount of effort required to optimise the JavaScript delivery.</p> <h2 id="recommendations">Recommendations</h2> <h3 id="test-on-representative-devices-and-networks">Test on representative devices and networks</h3> <p>Building great user experiences requires a large dose of empathy, and one of the easiest ways to get this empathy is by using your product in the same way that your users do. Pick up a mid-range Android phone or an Intel Celeron laptop and see how your product feels on those devices. The great thing about using the same devices as your users is that they are cheap - often 10-20x cheaper than the MacBook Pro used by many developers.</p> <h3 id="render-the-core-content-on-the-server">Render the core content on the server</h3> <p>I&#x2019;ve always been an advocate for having a good <a href="/redefining-the-bcc-news-core-experience/">core experience</a>. If you&#x2019;re not familiar with the concept of a core experience, I define it as follows:</p> <blockquote> <p>A core experience should be made up of these five things, in order of importance:</p> <ol> <li>The page content.</li> <li>The markup required to make the page accessible.</li> <li>Minimal styling to make the content easily readable &#x2013; grids, typography, etc.</li> <li>Minimal styling to brand the page &#x2013; logo, colours.</li> <li>The means to enhance the page where appropriate.</li> </ol> <p>A core experience should be <em>just</em> these things. Everything else is an enhancement.</p> </blockquote> <p>This might sound familiar if you know about <a href="https://developer.mozilla.org/en-US/docs/Glossary/Progressive_Enhancement">progressive enhancement</a>, since having a core experience is a prerequisite for doing any progressive enhancement.</p> <p>Not only does a good core experience enable users to view your product on practically any device or browser, it can also be hugely beneficial to page performance. TradeMe is a perfect example of this, with my experiment showing a 15-19 second reduction in the time to render core content.</p> <h3 id="reduce-the-amount-of-javascript-you-ship">Reduce the amount of JavaScript you ship</h3> <p>JavaScript is a hot topic in 2018. It is by far the biggest contributor to slow user experiences on the web &#x2013; if you haven&#x2019;t already read Addy Osmani&#x2019;s <a href="https://medium.com/@addyosmani/the-cost-of-javascript-in-2018-7d8950fbb5d4"><em>The Cost Of JavaScript in 2018</em></a> then I would recommend doing so.</p> <p>In the last few years, the web developer ecosystem has come leaps and bounds. With tools like npm and Webpack, it&#x2019;s easier than ever before to create interactive user experiences and bundle them up to be delivered on the web. An unfortunate downside to this is that it&#x2019;s easier than ever before to create huge JavaScript bundles that don&#x2019;t perform well.</p> <p>Right now there are no easy answers to The JavaScript Problem. The best thing that developers can do today is to remain diligent and balance ease of development with user experience.</p> <h3 id="use-performance-budgets">Use performance budgets</h3> <p>Before you even start working on a project, set yourself budgets on key user experience metrics like First Interactive, Hero Element Render Time, and JavaScript bundle size. Keep an eye on your budgets and <strong>always fix problems that break your budgets</strong>. Performance budgets are becoming a de facto feature of performance monitoring tools. We used <a href="https://speedcurve.com/blog/performance-budgets-in-action/">SpeedCurve&#x2019;s performance budgets</a> at the BBC to set performance targets and receive alerts when we broke the budgets.</p> <h2 id="wrapping-up">Wrapping up</h2> <p>I hope this has been a useful insight into how I conduct performance reviews. I&#x2019;ll be doing more of these in the future, so if there&#x2019;s a part of the review that you think I should focus on more, or a particular website that you&#x2019;d like me to review, let me know!</p> </article> <div class="wrap pt-4"> <p> <i>Have any questions or comments? Feel free to reach out on Twitter: <a href="https://twitter.com/Joseph_Wynn">@Joseph_Wynn</a></i> </p> <small> <blockquote> <p>This post was published on <b>22 August, 2018</b> and last updated on <b>4 September, 2018</b>. It was posted in [<a href="/category/Performance/">Performance</a>, <a href="/category/Web Development/">Web Development</a>] and tagged with [<a href="/tag/javascript/">javascript</a>, <a href="/tag/performance/">performance</a>, <a href="/tag/review/">review</a>] </p> </blockquote> </small> </div> <footer class="wrap mw-w mt-5 pt-4"> <ul class="ls-n f-r"> <li> <a href="https://github.com/wildlyinaccurate"> <span class="d-ib va-m w-4 h-4"> <svg viewbox="0 0 16 16"> <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/> </svg> </span> <span>wildlyinaccurate</span> </a> </li> <li> <a href="https://twitter.com/joseph_wynn"> <span class="d-ib va-m w-4 h-4"> <svg viewbox="0 0 16 16"> <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                        c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/> </svg> </span> <span>joseph_wynn</span> </a> </li> </ul> <small> <i>A collection of guides &amp; opinions about programming and the state of the web. </i> </small> </footer> <script> if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/service-worker.js')
            }

            
            window.LUX = {
                label: 'article'
            } </script> <script src="https://cdn.speedcurve.com/js/lux.js?id=73376842" async defer="defer"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-20744182-3', { siteSpeedSampleRate: 100 });
            ga('send', 'pageview'); </script> <script> (function() {
                var s, p, n, a;

                s = document.createElement('script');
                s.async = 1;
                s.defer = 1;
                s.src = 'https://cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=wildlyinaccuratecom';
                s.id = '_carbonads_js';

                p = document.createElement('small');
                p.className = 'ta-c';
                p.appendChild(s);

                n = document.querySelector('article > p:nth-of-type(3)');

                if (n) {
                    n.parentNode.insertBefore(p, n.nextSibling);
                } else {
                    n = document.getElementsByTagName('article')[0];
                    n.parentNode.insertBefore(p, n.nextSibling);
                }
            })(); </script> </body> </html> 